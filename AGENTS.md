## Project Overview

Deskulpt is a cross-platform desktop app built with Tauri v2. It allows users to create desktop widgets by writing React components.

## Repository Structure

### Rust Backend (`crates/`)

- `deskulpt/`: The main application binary. It should only wire things up and should not contain heavy logic.
- `deskulpt-core/`: An internal Tauri plugin for core backend functionalities. This is going to be broken up into smaller crates in the future.
- `deskulpt-widgets/`: An internal Tauri plugin for Deskulpt widgets management.
- `deskulpt-workspace/`: Workspace utilities.
- `deskulpt-build/`: Build system utilities.

### TypeScript/React Frontend (`packages/`)

- `deskulpt-canvas/`: The Deskulpt canvas window for widget rendering. This is a transparent window layered on top of the desktop.
- `deskulpt-manager/`: The Deskulpt manager interface for managing widgets, adjusting settings, etc.
- `deskulpt-bindings/`: Bindings for types, Tauri commands, and Tauri events.

## Autogenerated Files

MANDATORY: NEVER edit these files directly.

- `crates/deskulpt-core/gen/` and `gen/`: Based on `packages/apis/`, `packages/react/`, and `packages/ui/`, auto-generated by `pnpm build:packages`.
- `packages/deskulpt-bindings/src/`: Based on the backend, auto-generated by `cargo gen bindings`.

## Development Commands

### Build

- `pnpm install`: Install frontend dependencies.
- `pnpm build`: Build the frontend.
- `cargo check`: Check the backend for compilation errors.
- `pnpm tauri build --debug --no-bundle`: Build the full app.
- `cargo gen bindings`: Generate frontend bindings. Always re-run this before building the frontend or the full app, if you have modified backend types that derive `specta::Type` or Tauri commands that are marked with `#[specta::specta]`.

### Quality Assurance

- `pnpm format`: Format everything.
- `pnpm format:rs`: Format Rust code with `rustfmt`.
- `pnpm format:js`: Format everything else with `prettier`.
- `pnpm lint`: Lint everything.
- `pnpm lint:rs`: Lint Rust code with `clippy`.
- `pnpm lint:js`: Lint JS/TS with `oxlint` (a more performant `eslint`).
- `pnpm test`: Run all tests.
- `pnpm test:rs`: Run Rust tests.
- `pnpm test:js`: Run JS/TS tests (currently none).

## Testing Guidelines

MANDATORY: NEVER change existing tests unless explicitly requested by the user. If you really have good reasons to change existing tests, ALWAYS ask the user for permission first.

## Common Pitfalls & Best Practices

- **Check surrounding code for conventions:** Before adding new code, always study the existing patterns, naming conventions, and architectural choices in the file and directory you are working in.
- **Break large changes into tracked steps:** Decompose substantial work into manageable subtasks. Track progress to prevent scope creep and missed items. Use `TodoWrite` or similar tools to maintain a checklist if available.
